<!doctype html><html lang=en>
<head>
<title>Quorum in etcd :: xujiajiadexiaokeai</title>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Quorum in etcd">
<meta name=keywords content>
<meta name=robots content="noodp">
<link rel=canonical href=https://xujiajiadexiaokeai.github.io/2021-10-12/quorum-in-etcd/>
<link rel=stylesheet href=https://xujiajiadexiaokeai.github.io/assets/style.css>
<link rel=apple-touch-icon href=https://xujiajiadexiaokeai.github.io/img/apple-touch-icon-192x192.png>
<link rel="shortcut icon" href=https://xujiajiadexiaokeai.github.io/favicon.ico>
<meta name=twitter:card content="summary">
<meta property="og:locale" content="en">
<meta property="og:type" content="article">
<meta property="og:title" content="Quorum in etcd">
<meta property="og:description" content="Quorum in etcd">
<meta property="og:url" content="https://xujiajiadexiaokeai.github.io/2021-10-12/quorum-in-etcd/">
<meta property="og:site_name" content="xujiajiadexiaokeai">
<meta property="og:image" content="https://xujiajiadexiaokeai.github.io/favicon.ico">
<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">
<meta property="article:published_time" content="2021-10-12 22:44:30 +0800 +0800">
</head>
<body class=orange>
<div class="container center headings--one-size">
<header class=header>
<div class=header__inner>
<div class=header__logo>
<a href=/>
<div class=logo>
RTSC && RTFM
</div>
</a>
</div>
<div class=menu-trigger>menu</div>
</div>
<nav class=menu>
<ul class="menu__inner menu__inner--desktop">
<li><a href=/about>About</a></li>
<li><a href=/archive>Archive</a></li>
</ul>
<ul class="menu__inner menu__inner--mobile">
<li><a href=/about>About</a></li>
<li><a href=/archive>Archive</a></li>
</ul>
</nav>
</header>
<div class=content>
<div class=post>
<h1 class=post-title>
<a href=https://xujiajiadexiaokeai.github.io/2021-10-12/quorum-in-etcd/>Quorum in etcd</a></h1>
<div class=post-meta>
<span class=post-date>
2021-10-12
</span>
<span class=post-author>:: Wenhao Jiang</span>
<span class=post-reading-time>:: 1 min read (41 words)</span>
</div>
<span class=post-tags>
#<a href=https://xujiajiadexiaokeai.github.io/tags/etcd/>etcd</a>&nbsp;
#<a href=https://xujiajiadexiaokeai.github.io/tags/distributed-system/>distributed-system</a>&nbsp;
</span>
<div class=post-content><div>
<h1 id=cap>CAP<a href=#cap class=hanchor arialabel=Anchor>&#8983;</a> </h1>
<p>一致性(Consistency)、可用性(Availability)、分区容错性(Partition tolerance)</p>
<h1 id=waro>WARO<a href=#waro class=hanchor arialabel=Anchor>&#8983;</a> </h1>
<p>(Write All Read One)一种简单的副本控制协议。当Client请求向某副本写数据时,只有当所有的副本都更新成功后,才算写成功,否则都视为失败。</p>
<p>WARO牺牲了更新服务的可用性,最大程度增强了读服务的可用性</p>
<h1 id=quorum>Quorum<a href=#quorum class=hanchor arialabel=Anchor>&#8983;</a> </h1>
<p>一种权衡机制, 一种将“读写转化”的模型</p>
<p>quorum是“抽屉原理”的一个应用。定义:假设有N个副本,更新操作wi在W个副本中更新成功后,才认为此次更新操作wi成功。称成功提交的更新操作对应的数据为“成功提交的数据”。对于读操作而言,至少需要读R个副本才能读到此次更新的数据。其中,W+R>N,即W和R有重叠。一般W+R=N+1</p>
<h2 id=quorum机制分析>Quorum机制分析<a href=#quorum机制分析 class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<p><strong>Quorum机制无法保证强一致性</strong></p>
<p>如何读取最新的数据:在已经知道最近成功提交的数据版本号的前提下,最多读R个副本就可以了</p>
<p>如何确定 最高版本号 的数据是一个成功提交的数据: 继续读其他副本,直到读到了 W 次</p>
<p>基于Quorum机制选primary</p>
<p>中心节点读取R个副本,选择R个副本中版本号最高的副本作为新的Primary。</p>
<p>新选出的primary不能立即提供服务,还需要与至少W个副本完成同步后,才能提供服务 &mdash;&ndash;> 为了保证Quorum的规则: W+R > N</p>
<h3 id=如何处理冲突>如何处理冲突？<a href=#如何处理冲突 class=hanchor arialabel=Anchor>&#8983;</a> </h3>
<p>(V2,V2,V1,V1,V1) R = 3</p>
<p>如果读取的是(V1,V1,V1),则V2需要丢弃</p>
<p>如果是(V2,V1,V1),则V1需要同步到V2</p>
<h2 id=quorum-在etcd中的应用>Quorum 在etcd中的应用<a href=#quorum-在etcd中的应用 class=hanchor arialabel=Anchor>&#8983;</a> </h2>
<p>Quorum在etcd中主要作用有两个,一个是计算已被多数节点接收(Match)的Index,二是在进行Leader选举时,计算选举结果。</p>
<p>raft/quorum/quorum.go</p>
</div></div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=https://xujiajiadexiaokeai.github.io/2021-10-16/linux-network-notes/>
<span class=button__icon>←</span>
<span class=button__text>Linux Network Notes</span>
</a>
</span>
<span class="button next">
<a href=https://xujiajiadexiaokeai.github.io/posts/go-select/>
<span class=button__text>为什么select仅能作用于管道?</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</div>
</div>
<footer class=footer>
<div class=footer__inner>
<div class="copyright copyright--user">
<span>© 2021-2022 xujiajiadexiaokeai</span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span>
</div>
</div>
</footer>
<script src=https://xujiajiadexiaokeai.github.io/assets/main.js></script>
<script src=https://xujiajiadexiaokeai.github.io/assets/prism.js></script>
</div>
</body>
</html>